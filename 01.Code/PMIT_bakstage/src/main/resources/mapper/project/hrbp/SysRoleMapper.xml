<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.isoftstone.pmit.project.hrbp.mapper.SysRoleMapper">
    <resultMap id="SysRoleResult" type="com.isoftstone.pmit.project.hrbp.entity.SysRole">
        <id column="role_id"  property="roleId" />
        <result column="role_name"  property="roleName" />
        <result column="role_key"  property="roleKey" />
        <result column="role_sort"  property="roleSort" />
        <result column="data_scope" property="dataScope" />
        <result column="status"  property="status" />
        <result column="create_by"  property="createBy" />
        <result column="create_time"  property="createTime" />
        <result column="update_by"  property="updateBy" />
        <result column="update_time"  property="updateTime"/>
        <result column="description" property="description"/>
        <result column="remark" property="remark"/>
    </resultMap>

    <sql id="roleColumn">
        role_id roleId,
        role_name roleName,
        role_key roleKey,
        role_sort roleSort,
        data_scope dataScope,
        status,
        create_by createBy,
        create_time createTime,
        update_by updateBy,
        remark
    </sql>
    <select id="getAllRoles" parameterType="map" resultMap="SysRoleResult">
        SELECT
        r.role_id roleId,
        r.role_name roleName,
        r.role_key roleKey,
        r.role_sort roleSort,
        r.data_scope dataScope,
        r.status,
        r.create_by createBy,
        r.create_time createTime,
        r.update_by updateBy,
        r.remark
        FROM
        sys_role AS r
        where 1=1
        <if test="role_id != null and role_id != ''">
            and r.role_id = '${roleId}'
        </if>
        <if test="null != dictName and dictName !=''">
            AND r.role_name='${roleName}'
        </if>
        <if test="null != dictType and dictType !=''">
            AND r.role_key='${roleKey}'
        </if>
        ORDER BY r.role_sort ASC
    </select>

    <select id="getRolesByEmployeeID" parameterType="java.lang.String" resultType="com.isoftstone.pmit.project.hrbp.entity.SysRole">
      select
      sr.role_id id,
      r.role_name,
      r.role_key
      from
      sys_staffinfo_role sr
      inner join sys_role r on r.role_id = sr.role_id
      where sr.employee_id = #{employeeID}
    </select>

    <insert id="insertSystemRole" parameterType="SysRole" keyProperty="role_id">
        insert into sys_role(
        <if test="role_name != null and role_name != ''">role_name,</if>
        <if test="role_key != null and role_key != ''">role_key,</if>
        <if test="role_sort != null and role_sort != ''">role_sort,</if>
        <if test="data_scope != null and data_scope != ''">data_scope,</if>
        <if test="status != null and status != ''">status,</if>
        <if test="create_by != null and create_by != ''">create_by,</if>
        create_time,
        <if test="update_by != null and update_by != ''">update_by,</if>
        <if test="update_time != null and update_time != ''">update_time,</if>
        <if test="description != null and description != ''">description</if>
        <if test="remark != null and remark != ''">remark</if>
        )
        VALUES(
        <if test="role_name != null and role_name != ''">#{role_name},</if>
        <if test="role_key != null and role_key != ''">#{role_key},</if>
        <if test="role_sort != null and role_sort != ''">#{role_sort},</if>
        <if test="data_scope != null and data_scope != ''">#{data_scope},</if>
        <if test="status != null and status != ''">#{status},</if>
        <if test="create_by != null and create_by != ''">#{create_by},</if>
        now(),
        <if test="update_by != null and update_by != ''">#{update_by},</if>
        <if test="update_time != null and update_time != ''">#{update_time},</if>
        <if test="description != null and description != ''">#{description}</if>
        <if test="remark != null and remark != ''">#{remark}</if>
        )
    </insert>

    <update id="deleteSystemRole" parameterType="java.lang.String">
        update sys_role set status = 0 where role_id = #{_paramter}
    </update>

    <update id="updateSystemRole" parameterType="SysRole">
        update sys_role
        <set>
            <if test="role_name != null and role_name != ''">role_name = #{role_name},</if>
            <if test="role_key != null and role_key != ''">role_key = #{role_key},</if>
            <if test="role_sort != null and role_sort != ''">role_sort = #{role_sort},</if>
            <if test="data_scope != null and data_scope != ''">data_scope= #{data_scope},</if>
            <if test="status != null and status != ''">status = #{status},</if>
            <if test="create_by != null and create_by != ''">create_by = #{create_by},</if>
            create_time = now(),
            <if test="update_by != null and update_by != ''">update_by = #{update_by},</if>
            <if test="description != null and description != ''">description = #{description}</if>
            <if test="remark != null and remark != ''">#{remark}</if>
        </set>
    </update>

</mapper>