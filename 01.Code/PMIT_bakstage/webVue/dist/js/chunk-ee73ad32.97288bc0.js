(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ee73ad32"],{6929:function(e,t,a){"use strict";var r=a("76fd"),n=a.n(r);n.a},"76fd":function(e,t,a){},fa71:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:10}},[a("el-card",{attrs:{shadow:"never"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e._v("人力体系树")]),a("div",{staticClass:"ztree",staticStyle:{height:"390px"},attrs:{id:"empRelationTree"}})])],1),a("el-col",{staticClass:"em-list",attrs:{span:14}},[a("el-card",{attrs:{shadow:"never"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e._v("人力体系节点")]),a("el-form",{ref:"searchForm",staticClass:"em-wrap",attrs:{inline:!0,model:e.searchForm}},[a("el-form-item",{attrs:{label:""}},[a("el-input",{staticStyle:{width:"193px"},attrs:{placeholder:"PDU",size:"mini",disabled:""},model:{value:e.searchForm.pdu,callback:function(t){e.$set(e.searchForm,"pdu",t)},expression:"searchForm.pdu"}})],1),a("el-form-item",{attrs:{label:""}},[a("el-select",{attrs:{size:"mini",clearable:"",placeholder:"性别"},model:{value:e.searchForm.gender,callback:function(t){e.$set(e.searchForm,"gender",t)},expression:"searchForm.gender"}},[a("el-option",{attrs:{label:"男",value:"0"}}),a("el-option",{attrs:{label:"女",value:"1"}})],1)],1),a("el-form-item",{attrs:{label:""}},[a("el-select",{attrs:{size:"mini",clearable:"",placeholder:"地域"},on:{change:e.regionChange},model:{value:e.region,callback:function(t){e.region=t},expression:"region"}},e._l(e.regionOptions,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}))],1),a("el-form-item",{attrs:{label:""}},[a("el-select",{attrs:{size:"mini",clearable:"",placeholder:"成本中心"},model:{value:e.costCenter,callback:function(t){e.costCenter=t},expression:"costCenter"}},e._l(e.costCenterOptions,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}))],1),a("el-form-item",{attrs:{label:""}},[a("el-input",{staticStyle:{width:"193px"},attrs:{placeholder:"姓名",size:"mini",clearable:""},model:{value:e.searchForm.employeeName,callback:function(t){e.$set(e.searchForm,"employeeName",t)},expression:"searchForm.employeeName"}})],1),a("el-form-item",{attrs:{label:""}},[a("el-input",{staticStyle:{width:"193px"},attrs:{placeholder:"工号",size:"mini",clearable:""},model:{value:e.searchForm.employeeID,callback:function(t){e.$set(e.searchForm,"employeeID",t)},expression:"searchForm.employeeID"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:function(t){e.handleFilter()}}},[e._v(e._s(e.$t("table.search")))])],1)],1),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"ztree",staticStyle:{height:"260px"},attrs:{id:"empListTree"}}),a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-pagination",{attrs:{"current-page":e.currentPage,"page-size":e.pageSize,layout:"slot,prev, pager, next",total:e.total,"prev-text":"上一页","next-text":"下一页"},on:{"size-change":e.handleSizeChange,"current-change":e.handleSizeChange,"update:currentPage":function(t){e.currentPage=t}}})],1)],1)],1)],1),a("el-row",{staticStyle:{"margin-top":"20px"},attrs:{type:"flex",justify:"end"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline",size:"mini"},on:{click:e.handleSave}},[e._v("保 存")])],1)],1)},n=[],o=a("be94"),i=(a("cadf"),a("551c"),a("097d"),a("2654"),a("2f62")),s={data:function(){return{loading:!1,currentTreeId:"",currentPage:1,total:0,pageSize:100,employeeDataSource:[],employees:[],searchForm:{gender:"",employeeName:"",employeeID:""},relationSetting:{view:{showIcon:!1},edit:{enable:!0,showRemoveBtn:!1,showRenameBtn:!1,drag:{prev:!1,next:!1,inner:!0}},data:{simpleData:{enable:!0}},callback:{beforeDrag:this.beforeDrag1,beforeDrop:this.beforeDrop1}},empListSetting:{edit:{enable:!0,showRemoveBtn:!1,showRenameBtn:!1},data:{simpleData:{enable:!0}},callback:{beforeDrag:this.beforeDrag2,beforeDrop:this.beforeDrop2}}}},computed:Object(o["a"])({},Object(i["e"])({regionOptions:function(e){return e.eSettingsStore.regionData},costCenterOptions:function(e){return e.eSettingsStore.costCenterData}}),{region:{get:function(){return this.$store.state.eSettingsStore.region},set:function(e){this.$store.commit("updateTMRegino",e)}},costCenter:{get:function(){return this.$store.state.eSettingsStore.costCenter},set:function(e){this.$store.commit("updateTMCostCenter",e)}}}),mounted:function(){this.renderEmpRelationTree({})},watch:{employees:function(e){$.fn.zTree.init($("#empListTree"),this.empListSetting,e.map(function(e){return{id:e.staffId,employeeName:e.staffName,name:e.staffName+" ("+e.staffId+")"}}))}},methods:Object(o["a"])({},Object(i["b"])(["getAreaAndCuBycondition","getTMEmployees","getEmployeesByTeam","saveTeamInfos"]),{beforeDrag1:function(e,t){return this.currentTreeId=e,!t[0].disDrop},beforeDrop1:function(e,t,a,r){return!a&&this.currentTreeId!==e},beforeDrag2:function(e,t){return this.currentTreeId=e,!0},beforeDrop2:function(e,t,a,r){return a.level>0?(this.$message.warning("只能拖动到项目组名称(一级节点)上面"),!1):!!a&&this.currentTreeId!==e},handleSizeChange:function(e){this.total=this.employeeDataSource.length,this.employees=this.employeeDataSource.slice(100*(this.currentPage-1),100*this.currentPage+1)},regionChange:function(){this.$store.commit("updateCostCenterData")},handleFilter:function(){var e=this,t=$.fn.zTree.getZTreeObj("empRelationTree"),a=t.getNodesByFilter(function(e){return e.level>0});e.currentPage=1,e.loading=!0,e.getTMEmployees(e.searchForm).then(function(t){t.success?e.employeeDataSource=t.data.filter(function(e){return!_.contains(_.pluck(a,"id"),e.staffId)}):e.employeeDataSource=[],e.loading=!1,e.handleSizeChange()})},handleSave:function(){var e=this,t=$.fn.zTree.getZTreeObj("empRelationTree");if(t){var a=t.getNodesByFilter(function(e){return e.level>0}),r=a.map(function(e){return{staffId:e.id+"",staffName:e.employeeName}});e.saveTeamInfos(r).then(function(t){t.success?e.$message.success("人员设置保存成功"):e.$message.error("人员设置保存失败")})}},renderEmpRelationTree:function(e){var t=this;t.zNodes=[],t.zNodes.push({id:1,pId:0,open:!0,disDrop:!0,name:(e.projectName||"项目组名称")+"（"+(e.pmName||"PM姓名")+"）"}),t.getEmployeesByTeam(e.projectID).then(function(e){e.success&&(t.zNodes[0].children=e.data.map(function(e){return{id:e.staffId,employeeName:e.staffName,name:e.staffName+" ("+e.staffId+")"}})),$.fn.zTree.init($("#empRelationTree"),t.relationSetting,t.zNodes),t.handleFilter()})}})},l=s,c=(a("6929"),a("2877")),m=Object(c["a"])(l,r,n,!1,null,null,null);m.options.__file="humanSystem.vue";t["default"]=m.exports}}]);
//# sourceMappingURL=chunk-ee73ad32.97288bc0.js.map