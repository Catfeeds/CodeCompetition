(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-44296ac8"],{"0340":function(e,t,r){"use strict";r.d(t,"a",function(){return i});var a=r("1157"),o=r.n(a);function i(e){var t=o.a.extend(!0,{method:"post"},e),r=o()('<iframe id="down-file-iframe" />'),a=o()('<form target="down-file-iframe" method="'+t.method+'" />');for(var i in a.attr("action",t.url),t.data)a.append('<input type="hidden" name="'+i+'" value="'+t.data[i]+'" />');r.append(a),o()(document.body).append(r),a[0].submit(),r.remove()}},"17a9":function(e,t,r){},"289c":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container score-display"},[r("el-form",{staticClass:"search-condition",attrs:{inline:!0,model:e.searchForm}},[r("el-form-item",[r("el-select",{staticStyle:{width:"120px"},attrs:{size:"mini",clearable:"",placeholder:"所属系列"},model:{value:e.searchForm.series,callback:function(t){e.$set(e.searchForm,"series",t)},expression:"searchForm.series"}},e._l(e.searchForm.seriesOptions,function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})}))],1),r("el-form-item",[r("el-select",{staticStyle:{width:"110px"},attrs:{clearable:"",size:"mini",placeholder:"属性"},model:{value:e.searchForm.property,callback:function(t){e.$set(e.searchForm,"property",t)},expression:"searchForm.property"}},e._l(e.searchForm.propertypeOptions,function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})}))],1),r("el-form-item",[r("el-select",{staticStyle:{width:"120px"},attrs:{clearable:"",size:"mini",placeholder:"所属产品线"},model:{value:e.searchForm.product,callback:function(t){e.$set(e.searchForm,"product",t)},expression:"searchForm.product"}},e._l(e.searchForm.productOptions,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),r("el-form-item",[r("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini",clearable:"",placeholder:"培训名称"},model:{value:e.searchForm.trainName,callback:function(t){e.$set(e.searchForm,"trainName",t)},expression:"searchForm.trainName"}})],1),r("el-form-item",[r("el-date-picker",{attrs:{size:"mini",type:"datetimerange","range-separator":"至",format:"yyyy-MM-dd HH:mm","value-format":"yyyy-MM-dd HH:mm","start-placeholder":"得分开始时间","end-placeholder":"得分结束时间"},model:{value:e.searchForm.scoreTime,callback:function(t){e.$set(e.searchForm,"scoreTime",t)},expression:"searchForm.scoreTime"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-search"},on:{click:e.handleFilter}},[e._v(e._s(e.$t("table.search")))])],1),r("el-form-item",[r("el-button",{staticClass:"filter-item",attrs:{type:"primary",size:"mini",icon:"el-icon-download"},on:{click:e.handleExport}},[e._v(e._s(e.$t("button.export")))])],1),r("el-form-item",[r("el-upload",{staticClass:"filter-item",attrs:{action:e.importAction(),"before-upload":e.handleUpload,"on-success":e.handleSuccess,"on-error":e.handleError,"show-file-list":!1,disabled:e.isEdit,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"}},[r("el-button",{attrs:{size:"mini",icon:"el-icon-upload2",type:"primary"}},[e._v(e._s(e.$t("button.import")))])],1)],1),r("el-form-item",[r("el-button",{staticClass:"filter-item",attrs:{type:"primary",size:"mini",icon:"el-icon-download"},on:{click:e.handleTemplate}},[e._v(e._s(e.$t("button.template")))])],1)],1),r("div",[r("el-form",{ref:"tableForm",attrs:{model:e.tableForm}},[r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableForm.dataTable,border:"",fit:"",size:"mini",stripe:"","max-height":"420","highlight-current-row":""},on:{"sort-change":e.handleSort}},[r("el-table-column",{attrs:{"header-align":"center",align:"center",label:e.$t("table.id"),width:"50",type:"index"}}),r("el-table-column",{attrs:{width:"100px","header-align":"center",label:"软通工号",sortable:e.sortable,prop:"employeeID"}}),r("el-table-column",{attrs:{width:"100px","header-align":"center",label:"员工姓名",sortable:e.sortable,prop:"employeeName"}}),r("el-table-column",{attrs:{width:"70px","header-align":"center",label:"属性",sortable:e.sortable,prop:"types"}}),r("el-table-column",{attrs:{"min-width":"100","header-align":"center",label:"得分时间",sortable:e.sortable,prop:"scoreTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e._f("formatDate")(t.row.scoreTime)))])]}}])}),r("el-table-column",{attrs:{"min-width":"100","header-align":"center",label:"名称",sortable:e.sortable,prop:"affairName"},scopedSlots:e._u([{key:"default",fn:function(t){return["评价"!==t.row.types?r("span",[e._v(e._s(t.row.affairName))]):r("el-popover",{attrs:{placement:"right-end",title:"评价详情",width:"600",trigger:"hover"}},[r("el-table",{staticStyle:{width:"100%"},attrs:{data:t.row.personalTranAndDimeScores,border:"",fit:"",size:"mini",stripe:"","max-height":"400","tooltip-effect":"dark"}},[r("el-table-column",{attrs:{"header-align":"center",align:"center",label:e.$t("table.id"),width:"50",type:"index"}}),r("el-table-column",{attrs:{prop:"dimensionName","header-align":"center",label:"考核维度",width:"150"}}),r("el-table-column",{attrs:{prop:"score","header-align":"center",label:"得分",width:"100"}}),r("el-table-column",{attrs:{prop:"evaluation","header-align":"center",label:"评价","show-overflow-tooltip":""}})],1),r("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v(e._s(t.row.affairName))])],1)]}}])}),r("el-table-column",{attrs:{width:"110","header-align":"center",label:"所属系列",sortable:e.sortable,prop:"series"}}),r("el-table-column",{attrs:{width:"120","header-align":"center",label:"所属产品线",sortable:e.sortable,prop:"bu"}}),r("el-table-column",{attrs:{"min-width":"70","header-align":"center",label:"得分",sortable:e.sortable,prop:"score"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEdit?r("el-form-item",{attrs:{prop:"dataTable."+t.$index+".score",rules:e.rules.score}},[r("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini","controls-position":"right"},model:{value:t.row.score,callback:function(r){e.$set(t.row,"score",r)},expression:"scope.row.score"}})],1):r("span",[e._v(e._s(t.row.score))])]}}])}),e.isEdit?e._e():r("el-table-column",{attrs:{"min-width":"150","header-align":"center",label:"成本中心",sortable:e.sortable,prop:"costCenter"}}),r("el-table-column",{attrs:{width:"110","header-align":"center",label:"最后修改人",sortable:e.sortable,prop:"modifier"}}),r("el-table-column",{attrs:{width:"80","header-align":"center",align:"center",label:e.$t("table.option")},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEdit?e._e():r("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit",title:"编辑"},on:{click:function(r){e.handleEdit(t.row)}}}),t.row.isEdit?e._e():r("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete",title:"删除"},on:{click:function(r){e.handleDel(t.row)}}}),t.row.isEdit?r("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-circle-plus-outline",title:"保存"},on:{click:function(r){e.handleSave(t.row)}}}):e._e(),t.row.isEdit?r("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-remove-outline",title:"取消"},on:{click:function(t){e.handleFilter(null,e.page,!0)}}}):e._e()]}}])})],1)],1),r("el-row",{attrs:{type:"flex",justify:"end"}},[r("el-pagination",{attrs:{"current-page":e.page.currentPage,"page-size":e.page.pageSize,layout:"total, slot, prev, pager, next",total:e.page.totalRecord,disabled:e.isEdit,"prev-text":"上一页","next-text":"下一页"},on:{"current-change":e.handleCurrentChange}})],1)],1),r("el-dialog",{attrs:{title:"修改考核维度得分",visible:e.dialogSetVisible,width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogSetVisible=t}}},[r("el-form",{ref:"tableForm",attrs:{model:e.tableForm,size:"mini"}},[r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableForm.dimensionList,border:"",fit:"",size:"mini",stripe:"","max-height":"185","tooltip-effect":"dark","highlight-current-row":""}},[r("el-table-column",{attrs:{"header-align":"center",align:"center",label:e.$t("table.id"),width:"80",type:"index"}}),r("el-table-column",{attrs:{prop:"dimensionName","header-align":"center",label:"考核维度",width:"150"}}),r("el-table-column",{attrs:{prop:"score","header-align":"center",label:"得分",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-form-item",{attrs:{label:"",prop:"dimensionList."+t.$index+".score",rules:e.rules.score}},[r("el-input",{attrs:{autocomplete:"off",maxlength:"3"},model:{value:t.row.score,callback:function(r){e.$set(t.row,"score",r)},expression:"scope.row.score"}})],1)]}}])}),r("el-table-column",{attrs:{prop:"evaluation","header-align":"center",label:"评价"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-form-item",{attrs:{label:"",prop:"evaluation"}},[r("el-input",{attrs:{autocomplete:"off"},model:{value:t.row.evaluation,callback:function(r){e.$set(t.row,"evaluation",r)},expression:"scope.row.evaluation"}})],1)]}}])})],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.handleSave(e.tableForm.scoreInfo,!0)}}},[e._v("保 存")])],1)],1)],1)},o=[],i=(r("7f7f"),r("7514"),r("be94")),l=(r("c5f6"),r("cadf"),r("551c"),r("097d"),r("2f62")),n=r("c466"),s=r("0340"),c={filters:{formatDate:function(e){var t=new Date(e);return Object(n["a"])(t,"yyyy-MM-dd hh:mm")}},mounted:function(){this.getScoreProduct(),this.getScoreSeries(),this.handleFilter()},data:function(){var e=function(e,t,r){return t?isNaN(t)?r(new Error("只能输入整数和小数")):Number(t)>100||Number(t)<0?r(new Error("只能0~100的整数和小数")):r():r(new Error("请输入得分"))};return{listLoading:!1,isEdit:!1,sortable:"custom",tableForm:{dataTable:[],dimensionList:[],scoreInfo:null},page:{currentPage:1,pageSize:100,totalRecord:0,sortColumn:"employeeID",sortType:"desc"},dialogSetVisible:!1,rules:{score:[{required:!0,validator:e,trigger:"blur"}]}}},computed:Object(i["a"])({},Object(l["c"])(["employeeId","employeeName"]),Object(l["e"])({searchForm:function(e){return e.scoreDisplayStore.searchForm},dataSource:function(e){return e.scoreDisplayStore.scoreData}})),watch:{dataSource:function(e){this.tableForm.dataTable=e.list,this.page.totalRecord=e.total}},methods:Object(i["a"])({},Object(l["b"])(["getScoreProduct","getScoreSeries","getScoreDataList"]),{handleFilter:function(e,t,r){var a=this;r||!a.tableForm.dataTable.find(function(e){return e.isEdit})?(t||(a.page.currentPage=1),a.isEdit=!!r,r&&(a.isEdit=!1,a.sortable="custom"),a.listLoading=!0,a.getScoreDataList(a.page).then(function(){a.listLoading=!1}).catch(function(){a.listLoading=!1})):a.$message.warning("存在正在编辑的行，请先保存")},handleCurrentChange:function(e){this.page.currentPage=e,this.handleFilter(null,this.page)},handleEdit:function(e){this.tableForm.dataTable.find(function(e){return e.isEdit})?this.$message.warning("存在正在编辑的行，请先保存"):"评价"!==e.types?(e.isEdit=!0,this.sortable=!1,this.isEdit=!0):(this.tableForm.scoreInfo=e,this.dialogSetVisible=!0,this.tableForm.dimensionList=e.personalTranAndDimeScores)},handleSave:function(e,t){var r=this;r.$refs.tableForm.validate(function(t){if(!t)return!1;e.isEdit=!1,r.isEdit=!1,r.sortable="custom",e.modifier=r.employeeId,e.personalTranAndDimeScores.map(function(e){return e.modifier=r.employeeId,e}),r.$store.dispatch("editScoreInfo",e).then(function(e){e.success?(r.$message.success("成绩修改成功"),r.handleFilter(null,r.page)):r.$message.success("成绩修改失败"),r.dialogSetVisible=!1})})},handleDel:function(e){if(this.tableForm.dataTable.find(function(e){return e.isEdit}))this.$message.warning("存在正在编辑的行，请先保存");else{var t=this;t.$confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$store.dispatch("delScoreInfo",e).then(function(e){e.success?(t.$message.success("删除成功"),t.handleFilter(null,t.page)):t.$message.error("删除失败")})})}},handleSort:function(e){e.prop&&(this.page.sortColumn=e.prop,this.page.sortType="descending"===e.order?"desc":"asc",this.handleFilter(null,this.page))},importAction:function(){return"system/exceloperation/importScore?user="+this.employeeId},handleUpload:function(e){var t=e.name.substring(e.name.lastIndexOf(".")+1),r="xls"===t||"xlsx"===t,a=e.size/1024/1024<10;return r||this.$message({message:"上传文件只能是 xls、xlsx格式!",type:"warning"}),a||this.$message({message:"上传文件大小不能超过 10MB!",type:"warning"}),r||extension2&&a},handleSuccess:function(){this.$message.success("文件导入成功"),this.page.currentPage=1,this.getEmployeeList()},handleError:function(){this.$message.error("文件导入失败,请检查文件格式是否合法")},handleTemplate:function(){Object(s["a"])({url:"system/exceloperation/download/scoreTemplate",data:{}})},handleExport:function(){var e=this;Object(s["a"])({url:"system/exceloperation/exportScore",data:{bu:e.searchForm.product,series:e.searchForm.series,affairName:e.searchForm.trainName,types:e.searchForm.property,startTime:e.searchForm.scoreTime?Object(n["a"])(e.searchForm.scoreTime[0],"yyyy-MM-dd HH:mm:ss"):"",endTime:e.searchForm.scoreTime?Object(n["a"])(e.searchForm.scoreTime[1],"yyyy-MM-dd HH:mm:ss"):"",pageParam:{currPage:0,pageSize:0,sortColumn:"",sortType:""}}})}})},d=c,m=(r("946d"),r("2877")),p=Object(m["a"])(d,a,o,!1,null,null,null);p.options.__file="scoreDisplay.vue";t["default"]=p.exports},"946d":function(e,t,r){"use strict";var a=r("17a9"),o=r.n(a);o.a}}]);
//# sourceMappingURL=chunk-44296ac8.e2231723.js.map