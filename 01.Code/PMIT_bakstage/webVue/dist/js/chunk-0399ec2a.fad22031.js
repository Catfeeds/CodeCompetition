(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0399ec2a"],{"3e6b":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container role-container"},[r("el-row",{attrs:{type:"flex",justify:"end"}},[r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.addRole}},[e._v("新增")])],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"15px"},attrs:{data:e.tableData,border:"",fit:"",size:"mini",stripe:"","highlight-current-row":"","max-height":"450px"}},[r("el-table-column",{attrs:{"header-align":"center",align:"center",label:e.$t("table.id"),type:"index",width:"80"}}),r("el-table-column",{attrs:{"min-width":"150px","header-align":"center",label:"角色名称",prop:"roleName"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-popover",{attrs:{placement:"right-end",title:"菜单项",width:"300",trigger:"hover"}},[r("el-tree",{ref:"tree",attrs:{"aria-required":"",data:t.row.menuInfo,"node-key":"id","default-expand-all":"",props:e.defaultProps}}),r("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v(e._s(t.row.roleName))])],1)]}}])}),r("el-table-column",{attrs:{"min-width":"150px","header-align":"center",label:"角色描述",prop:"description"}}),r("el-table-column",{attrs:{align:"center",label:e.$t("table.option"),width:"110","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit",title:"编辑"},on:{click:function(r){e.handleEdit(t.row)}}}),r("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete",title:"删除"},on:{click:function(r){e.handleDel(t.row.roleId)}}})]}}])})],1),r("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("el-form",{ref:"roleForm",attrs:{model:e.roleForm,size:"mini","label-width":"80px",rules:e.rules}},[r("el-form-item",{attrs:{label:"角色名称",prop:"roleName"}},[r("el-input",{attrs:{autocomplete:"off",required:"",maxlength:"64"},model:{value:e.roleForm.roleName,callback:function(t){e.$set(e.roleForm,"roleName",t)},expression:"roleForm.roleName"}})],1),r("el-form-item",{attrs:{label:"角色描述",prop:"description"}},[r("el-input",{attrs:{autocomplete:"off",maxlength:"128"},model:{value:e.roleForm.description,callback:function(t){e.$set(e.roleForm,"description",t)},expression:"roleForm.description"}})],1),r("el-form-item",{attrs:{label:"菜单项",prop:"menuTree"}},[r("div",{staticStyle:{height:"150px"}},[r("el-scrollbar",[r("el-tree",{ref:"tree",attrs:{"aria-required":"",data:e.menuTreeData,"show-checkbox":"","node-key":"id","default-expand-all":"",props:e.defaultProps,"default-checked-keys":e.selectedNodes}})],1)],1)])],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.submtForm("roleForm")}}},[e._v("确 定")])],1)],1)],1)},n=[],i=(r("ac6a"),r("cadf"),r("551c"),r("097d"),{data:function(){var e=this,t=function(t,r,o){e.roleForm.menuIds=e.$refs.tree.getCheckedNodes().map(function(e){return{menuId:e.id}}),e.roleForm.menuIds.length<=0?o(new Error(t.message)):o()};return{dialogTitle:"",loading:!1,dialogVisible:!1,tableData:[],selectedNodes:[],roleForm:{roleName:"",description:"",menuIds:[]},defaultProps:{children:"children",label:"name"},rules:{roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"}],menuTree:[{required:!0,message:"请选项菜单项",validator:t,trigger:"change"}]},menuTreeData:[]}},mounted:function(){var e=this;this.getRoleList(),this.$store.dispatch("getAllMenuInfo").then(function(t){console.log(111),t.success?e.menuTreeData=t.data.filter(function(e){return!e.parentId&&e.menuId>1}).map(function(e){return{id:e.menuId,name:e.note,children:t.data.filter(function(t){return t.parentId===e.menuId}).map(function(e){return{id:e.menuId,name:e.note}})}}):e.menuTreeData=[]})},methods:{getRoleList:function(){var e=this;e.loading=!0,e.$store.dispatch("getSysRoleList").then(function(t){t.success?t.data.forEach(function(t){e.$store.dispatch("getMenuInfoByRoleId",t.roleId).then(function(r){r.success?t.menuInfo=r.data.filter(function(e){return!e.parentId&&e.menuId>1}).map(function(e){return{id:e.menuId,name:e.note,children:r.data.filter(function(t){return t.parentId===e.menuId}).map(function(e){return{id:e.menuId,name:e.note}})}}):t.menuInfo=[],e.tableData.push(t)})}):e.tableData=[],e.loading=!1}).catch(function(t){console.log(t),e.loading=!1})},handleDel:function(e){var t=this;t.$confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$store.dispatch("delSysRoleInfo",e).then(function(e){e.code?t.$message.error(e.msg):(t.$message.success(e.msg),t.getRoleList())})})},handleEdit:function(e){var t=this;t.$store.dispatch("getMenuInfoByRoleId",e.roleId).then(function(r){r.success&&(t.roleForm.roleName=e.roleName,t.roleForm.description=e.description,t.roleForm.roleId=e.roleId,t.dialogTitle="编辑角色",t.dialogVisible=!0,t.$refs.tree?(t.clearValidate("roleForm"),t.$refs.tree.setCheckedNodes(r.data.map(function(e){return{id:e.menuId,name:e.note}}))):t.selectedNodes=r.data.map(function(e){return e.menuId}))})},addRole:function(){this.dialogVisible=!0,this.dialogTitle="添加角色",this.roleForm.roleName="",this.roleForm.description="",this.roleForm.roleId=-1,this.$refs.tree&&(this.clearValidate("roleForm"),this.$refs.tree.setCheckedKeys([]))},submtForm:function(e){var t=this;t.$refs[e].validate(function(e){if(!e)return!1;var r={sysRole:{roleName:t.roleForm.roleName,description:t.roleForm.description},menuInfoList:t.roleForm.menuIds},o="addSysRoleInfo";t.roleForm.roleId>=0&&(o="editSysRoleInfo",r.sysRole.roleId=t.roleForm.roleId),t.$store.dispatch(o,r).then(function(e){e.success?(t.$message.success(e.message),t.dialogVisible=!1,t.getRoleList()):t.$message.error(e.message)})})},clearValidate:function(e){this.$refs[e].clearValidate()}}}),l=i,a=(r("5397"),r("2877")),s=Object(a["a"])(l,o,n,!1,null,null,null);s.options.__file="role.vue";t["default"]=s.exports},5397:function(e,t,r){"use strict";var o=r("95dc"),n=r.n(o);n.a},"95dc":function(e,t,r){}}]);
//# sourceMappingURL=chunk-0399ec2a.fad22031.js.map