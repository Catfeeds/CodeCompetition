(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0399ec2a"],{"3e6b":function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"app-container role-container"},[o("el-row",{attrs:{type:"flex",justify:"end"}},[o("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.addRole}},[e._v("新增")])],1),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"15px"},attrs:{data:e.tableData,border:"",fit:"",size:"mini",stripe:"","highlight-current-row":"","max-height":"450px"}},[o("el-table-column",{attrs:{"header-align":"center",align:"center",label:e.$t("table.id"),type:"index",width:"80"}}),o("el-table-column",{attrs:{"min-width":"150px","header-align":"center",label:"角色名称",prop:"roleName"}}),o("el-table-column",{attrs:{"min-width":"150px","header-align":"center",label:"角色描述",prop:"description"}}),o("el-table-column",{attrs:{align:"center",label:e.$t("table.option"),width:"80","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit",title:"编辑"},on:{click:function(o){e.handleEdit(t.row)}}}),o("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete",title:"删除"},on:{click:function(o){e.handleDel(t.row.roleId)}}})]}}])})],1),o("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[o("el-form",{ref:"roleForm",attrs:{model:e.roleForm,size:"mini","label-width":"80px",rules:e.rules}},[o("el-form-item",{attrs:{label:"角色名称",prop:"roleName"}},[o("el-input",{attrs:{autocomplete:"off",required:"",maxlength:"64"},model:{value:e.roleForm.roleName,callback:function(t){e.$set(e.roleForm,"roleName",t)},expression:"roleForm.roleName"}})],1),o("el-form-item",{attrs:{label:"角色描述",prop:"description"}},[o("el-input",{attrs:{autocomplete:"off",maxlength:"128"},model:{value:e.roleForm.description,callback:function(t){e.$set(e.roleForm,"description",t)},expression:"roleForm.description"}})],1),o("el-form-item",{attrs:{label:"菜单项",prop:"menuTree"}},[o("div",{staticStyle:{height:"150px"}},[o("el-scrollbar",[o("el-tree",{ref:"tree",attrs:{"aria-required":"",data:e.menuTreeData,"show-checkbox":"","node-key":"id","default-expand-all":"",props:e.defaultProps,"default-checked-keys":e.selectedNodes}})],1)],1)])],1),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.submtForm("roleForm")}}},[e._v("确 定")])],1)],1)],1)},i=[],l=(o("cadf"),o("551c"),o("097d"),{data:function(){var e=this,t=function(t,o,r){e.roleForm.menuIds=e.$refs.tree.getCheckedNodes().map(function(e){return{menuId:e.id}}),e.roleForm.menuIds.length<=0?r(new Error(t.message)):r()};return{dialogTitle:"",loading:!1,dialogVisible:!1,tableData:[],selectedNodes:[],roleForm:{roleName:"",description:"",menuIds:[]},defaultProps:{children:"children",label:"name"},rules:{roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"}],menuTree:[{required:!0,message:"请选项菜单项",validator:t,trigger:"change"}]},menuTreeData:[]}},mounted:function(){var e=this;this.getRoleList(),this.$store.dispatch("getAllMenuInfo").then(function(t){console.log(111),t.success?e.menuTreeData=t.data.filter(function(e){return!e.parentId&&e.menuId>1}).map(function(e){return{id:e.menuId,name:e.note,children:t.data.filter(function(t){return t.parentId===e.menuId}).map(function(e){return{id:e.menuId,name:e.note}})}}):e.menuTreeData=[]})},methods:{getRoleList:function(){var e=this;this.loading=!0,this.$store.dispatch("getSysRoleList").then(function(t){t.success?e.tableData=t.data:e.tableData=[],e.loading=!1}).catch(function(t){console.log(t),e.loading=!1})},handleDel:function(e){var t=this;t.$confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$store.dispatch("delSysRoleInfo",e).then(function(e){e.code?t.$message.error(e.msg):(t.$message.success(e.msg),t.getRoleList())})})},handleEdit:function(e){var t=this;t.$store.dispatch("getMenuInfoByRoleId",e.roleId).then(function(o){o.success&&(t.roleForm.roleName=e.roleName,t.roleForm.description=e.description,t.roleForm.roleId=e.roleId,t.dialogTitle="编辑角色",t.dialogVisible=!0,t.$refs.tree?(t.clearValidate("roleForm"),t.$refs.tree.setCheckedNodes(o.data.map(function(e){return{id:e.menuId,name:e.note}}))):t.selectedNodes=o.data.map(function(e){return e.menuId}))})},addRole:function(){this.dialogVisible=!0,this.dialogTitle="添加角色",this.roleForm.roleName="",this.roleForm.description="",this.roleForm.roleId=-1,this.$refs.tree&&(this.clearValidate("roleForm"),this.$refs.tree.setCheckedKeys([]))},submtForm:function(e){var t=this;t.$refs[e].validate(function(e){if(!e)return!1;var o={sysRole:{roleName:t.roleForm.roleName,description:t.roleForm.description},menuInfoList:t.roleForm.menuIds},r="addSysRoleInfo";t.roleForm.roleId>=0&&(r="editSysRoleInfo",o.sysRole.roleId=t.roleForm.roleId),t.$store.dispatch(r,o).then(function(e){e.success?(t.$message.success(e.message),t.dialogVisible=!1,t.getRoleList()):t.$message.error(e.message)})})},clearValidate:function(e){this.$refs[e].clearValidate()}}}),n=l,a=(o("5397"),o("2877")),s=Object(a["a"])(n,r,i,!1,null,null,null);s.options.__file="role.vue";t["default"]=s.exports},5397:function(e,t,o){"use strict";var r=o("95dc"),i=o.n(r);i.a},"95dc":function(e,t,o){}}]);
//# sourceMappingURL=chunk-0399ec2a.7edc835b.js.map